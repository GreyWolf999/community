<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>小新社区</title>
    <script src="webjars/jquery/3.4.0/jquery.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <link rel="stylesheet" th:href="@{webjars/layui/2.5.4/css/layui.css}">
    <link rel="stylesheet" href="MyCss/index.css">

</head>
<body class="bodys">
<!--   将相同的文件封装 然后在需要的地方直接插入-->
<div th:insert="~{footer :: nav}"></div>
<div class="row navp" >
    <div class="heads">
    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
        <h1><i class="layui-icon layui-icon-align-left"></i>发现</h1>
        <hr>
        <!--            流加载部分-->
        <ul class="flow-default" id="LAY_demo1"></ul>
    </div>
    <div class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
        <h1 class="">热门话题</h1>

    </div>
    </div>
</div>
<script th:src="@{webjars/layui/2.5.4/layui.js}"></script>
<script th:inline="javascript">
    //注意：导航 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function(){
        var element = layui.element;
    });
    layui.use('layer', function(){
        var layer = layui.layer;
        //判断是否在有效期登陆过
        var msg = [[${msg}]];
        if (msg != null) {
            layer.msg(msg)
        }
    });
    layui.use('flow', function(){
        var $ = layui.jquery; //不用额外加载jQuery，flow模块本身是有依赖jQuery的，直接用即可。
        var flow = layui.flow;
        ;
        flow.load({
            elem: '#LAY_demo1' //指定列表容器

            ,done: function(page, next){ //到达临界点（默认滚动触发），触发下一页
                var lis = [];
                //以jQuery的Ajax请求为例，请求下一页数据（注意：page是从2开始返回）
                $.post('/?page='+page, function(res){
                    //假设你的列表返回在data集合中
                    layui.each(res.data, function(index, item){
                        lis.push('<div class="media"><div class="media-left media-middle"><a href="#"><img class="media-object imageT" src='
                            +item.avatarUrl+'></a></div>'+'<div class="media-body textpei"><h4 class="media-heading" >'
                            +item.title+'</h4><a href="/hhh">'+item.tag+'</a><br><span><span>'
                            +item.commentCount+'</span>个回复 •<span>'
                            +item.viewCount+'</span>次浏览•<span>'+item.gmtCreate+'</span></span><hr></div></div>');
                    });
                    next(lis.join(''), page <res.pages);
                });
            }
        });
    });
    function shut(){
        $(".layui-layer-close1").trigger('click');
    }
    $('#login').on('click', function(){
        layer.open({
            type:2
            ,title:'登陆框'
            ,content:['/goLogin','no',]
            ,area: ['500px', '62%']
            ,shadeClose:true
            ,offset: 'auto'
            , zIndex: layer.zIndex
            , success: function (layero) {
                layer.setTop(layero); //重点2
            },
            end: function () {
                window.location.reload();
            }
        });
    });
    $('#register').on('click', function(){
        layer.open({
            type:2
            ,title:'登陆框'
            ,content:['/goRegister','no',]
            ,area: ['500px', '62%']
            ,shadeClose:true
            ,offset: 'auto'
        });
    });
    // 注销
    function doLogout() {
        $.ajax({
            url:"/logout",
            type:"GET",
            sync:false,
            success:function (data) {
                layer.msg(data,{
                    icon: 1,
                    time: 2000
                }, function(){
                    parent.location.href="/"
                })
            }
        })
    }
</script>
</body>
</html>
